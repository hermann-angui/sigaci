{% extends 'layout_b.html.twig' %}

{% block stylesheet %}

    <!-- Select2 CSS -->
    <link rel="stylesheet" href="{{ asset('theme_b/assets/plugins/select2/css/select2.min.css') }}">
    <!-- Datatable CSS -->
    <link rel="stylesheet" href="{{ asset('theme_b/assets/css/dataTables.bootstrap5.min.css') }}">
{#    <link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css">#}
{#    <link rel="stylesheet" href="https://cdn.datatables.net/fixedcolumns/5.0.4/css/fixedColumns.dataTables.css">#}
{#    <link rel="stylesheet" href="https://cdn.datatables.net/select/3.0.1/css/select.dataTables.css">#}


{% endblock %}

{% block body %}
    <!-- Start Content -->
    <div class="content">

        <!-- Start Page Header -->
        <div class="d-flex align-items-sm-center flex-sm-row flex-column gap-2 pb-3 mb-3 border-1 border-bottom">
            <div class="flex-grow-1">
                <h4 class="fw-bold mb-0">Liste des artisans <span class="badge badge-soft-primary fw-medium border py-1 px-2 border-primary fs-13 ms-1">TOTAL : {{ total }}</span></h4>
            </div>
            <div class="text-end d-flex">
                <!-- dropdown-->
                <div class="dropdown me-1">
                    <a href="javascript:void(0);" class="btn btn-md fs-14 fw-normal border bg-white rounded text-dark d-inline-flex align-items-center" data-bs-toggle="dropdown">
                        Export<i class="ti ti-chevron-down ms-2"></i>
                    </a>
                    <ul class="dropdown-menu p-2">
                        <li>
                            <a class="dropdown-item" href="#">Télécharger PDF</a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">Télécharger Excel</a>
                        </li>
                    </ul>
                </div>
                <div class="bg-white border shadow-sm rounded px-1 pb-0 text-center d-flex align-items-center justify-content-center">
                    <a href="" class="bg-light rounded p-1 d-flex align-items-center justify-content-center"> <i class="ti ti-list fs-14 text-dark"></i></a>
                    <a href="" class="bg-white rounded p-1 d-flex align-items-center justify-content-center"> <i class="ti ti-layout-grid fs-14 text-body"></i> </a>
                </div>

                <a href="{{ path('app_artisan_new') }}" class="btn btn-primary ms-2 fs-13 btn-md"><i class="ti ti-plus me-1"></i></a>
            </div>
        </div>
        <!-- End Page Header -->

        <div class="row row-cols-1 row-cols-xl-12 row-cols-md-12 row-cols-sm-12">

            <!-- col start -->
            <div class="col-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <p class="mb-1">Total Entreprises artisanales</p>
                                <div class="d-flex align-items-center gap-1">
                                    <h3 class="fw-bold mb-0">{{ total_entreprise_artisanale  }}</h3>
                                    <span class="badge fw-medium bg-success flex-shrink-0">+1%</span>
                                </div>
                            </div>
                            <span class="avatar border border-primary text-primary rounded-2 flex-shrink-0"><i class="ti ti-user fs-20"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- col end -->

            <!-- col start -->
            <div class="col-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <p class="mb-1">Total Maître artisans</p>
                                <div class="d-flex align-items-center gap-1">
                                    <h3 class="fw-bold mb-0">{{ total_maitre_artisan  }}</h3>
                                    <span class="badge fw-medium bg-success flex-shrink-0">+10%</span>
                                </div>
                            </div>
                            <span class="avatar border border-primary text-primary rounded-2 flex-shrink-0"><i class="ti ti-user fs-20"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- col end -->

            <!-- col start -->
            <div class="col-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <p class="mb-1">Total compagons</p>
                                <div class="d-flex align-items-center gap-1">
                                    <h3 class="fw-bold mb-0">{{ total_compagnons  }}</h3>
                                    <span class="badge fw-medium bg-success flex-shrink-0">+10%</span>
                                </div>
                            </div>
                            <span class="avatar border border-primary text-primary rounded-2 flex-shrink-0"><i class="ti ti-user fs-20"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- col end -->

            <!-- col start -->
            <div class="col-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <p class="mb-1">Total apprentis</p>
                                <div class="d-flex align-items-center gap-1">
                                    <h3 class="fw-bold mb-0">{{ total_apprentis  }}</h3>
                                    <span class="badge fw-medium bg-success flex-shrink-0">+95%</span>
                                </div>
                            </div>
                            <span class="avatar border border-primary text-primary rounded-2 flex-shrink-0"><i class="ti ti-user fs-20"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- col end -->

        </div>

        <!--  Start Filter -->
        <div class=" d-flex align-items-center justify-content-between flex-wrap">
            <div>
                <div class="search-set mb-3">
                    <div class="d-flex align-items-center flex-wrap gap-2">
                        <div class="table-search d-flex align-items-center mb-0">
                            <div class="search-input">
                                <a href="javascript:void(0);" class="btn-searchset"></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex table-dropdown mb-3 right-content align-items-center flex-wrap row-gap-3">
                <div class="dropdown me-2">
                    <a href="javascript:void(0);" class="bg-white border rounded btn btn-md text-dark fs-14 py-1 align-items-center d-flex fw-normal" data-bs-toggle="dropdown" data-bs-auto-close="outside">
                        <i class="ti ti-filter text-gray-5 me-1"></i>Filters
                    </a>
                    <div class="dropdown-menu dropdown-lg dropdown-menu-end filter-dropdown p-0" id="filter-dropdown">
                        <div class="d-flex align-items-center justify-content-between border-bottom filter-header">
                            <h4 class="mb-0 fw-bold">Filter</h4>
                            <div class="d-flex align-items-center">
                                <a href="javascript:void(0);" class="link-danger text-decoration-underline">Clear All</a>
                            </div>
                        </div>
                        <form action="#">
                            <div class="filter-body pb-0">
                                <div class="mb-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <label class="form-label">Patient</label>
                                        <a href="javascript:void(0);" class="link-primary mb-1">Reset</a>
                                    </div>
                                    <div class="dropdown">
                                        <a href="javascript:void(0);" class="dropdown-toggle btn bg-white  d-flex align-items-center justify-content-start fs-13 p-2 fw-normal border" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="true">
                                            Select <i class="ti ti-chevron-down ms-auto"></i>
                                        </a>
                                        <div class="dropdown-menu shadow-lg w-100 dropdown-info p-3">
                                            <div class="mb-3">
                                                <div class="input-icon-start input-icon position-relative">
                                                            <span class="input-icon-addon fs-12">
                                                                <i class="ti ti-search"></i>
                                                            </span>
                                                    <input type="text" class="form-control form-control-md" placeholder="Search">
                                                </div>
                                            </div>
                                            <ul class="mb-3">
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/users/user-33.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Alberto Ripley
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/users/user-12.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Bernard Griffith
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/users/user-02.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Carol Lam
                                                    </label>
                                                </li>
                                                <li>
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/users/user-08.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Ezra Belcher
                                                    </label>
                                                </li>
                                            </ul>
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-outline-white w-100 close-filter">Cancel</a>
                                                </div>
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-primary w-100">Select</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <label class="form-label">Doctor</label>
                                        <a href="javascript:void(0);" class="link-primary mb-1">Reset</a>
                                    </div>
                                    <div class="dropdown">
                                        <a href="javascript:void(0);" class="dropdown-toggle btn bg-white  d-flex align-items-center justify-content-start fs-13 p-2 fw-normal border" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="true">
                                            Select <i class="ti ti-chevron-down ms-auto"></i>
                                        </a>
                                        <div class="dropdown-menu shadow-lg w-100 dropdown-info p-3">
                                            <div class="mb-3">
                                                <div class="input-icon-start input-icon position-relative">
                                                            <span class="input-icon-addon fs-12">
                                                                <i class="ti ti-search"></i>
                                                            </span>
                                                    <input type="text" class="form-control form-control-md" placeholder="Search">
                                                </div>
                                            </div>
                                            <ul class="mb-3">
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/doctors/doctor-01.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Dr. Mick Thompson
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/doctors/doctor-02.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Dr. Sarah Johnson
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/doctors/doctor-03.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Dr. Emily Carter
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/doctors/doctor-04.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Dr. David Lee
                                                    </label>
                                                </li>
                                                <li class="mb-0">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        <span class="avatar avatar-xs rounded-circle me-2"><img src="assets/img/doctors/doctor-05.jpg" class="flex-shrink-0 rounded-circle" alt="img"></span>Dr. Anna Kim
                                                    </label>
                                                </li>
                                            </ul>
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-outline-white w-100 close-filter">Cancel</a>
                                                </div>
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-primary w-100">Select</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <label class="form-label">Designation</label>
                                        <a href="javascript:void(0);" class="link-primary mb-1">Reset</a>
                                    </div>
                                    <div class="dropdown">
                                        <a href="javascript:void(0);" class="dropdown-toggle btn bg-white  d-flex align-items-center justify-content-start fs-13 p-2 fw-normal border" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="true">
                                            Select <i class="ti ti-chevron-down ms-auto"></i>
                                        </a>
                                        <div class="dropdown-menu shadow-lg w-100 dropdown-info p-3">
                                            <div class="mb-3">
                                                <div class="input-icon-start input-icon position-relative">
                                                            <span class="input-icon-addon fs-12">
                                                                <i class="ti ti-search"></i>
                                                            </span>
                                                    <input type="text" class="form-control form-control-md" placeholder="Search">
                                                </div>
                                            </div>
                                            <ul class="mb-3">
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Cardiologist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Orthopedic Surgeon
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Pediatrician
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Gynecologist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Psychiatrist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Neurosurgeon
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Oncologist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Pulmonologist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Urologist
                                                    </label>
                                                </li>
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Dermatologist
                                                    </label>
                                                </li>
                                            </ul>
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-outline-white w-100 close-filter">Cancel</a>
                                                </div>
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-primary w-100">Select</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label mb-1 text-dark fs-14 fw-medium">Date<span class="text-danger">*</span></label>
                                    <div class="input-icon-end position-relative">
                                        <input type="text" class="form-control bookingrange" placeholder="dd/mm/yyyy">
                                        <span class="input-icon-addon">
                                                    <i class="ti ti-calendar"></i>
                                                </span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <label class="form-label">Status</label>
                                        <a href="javascript:void(0);" class="link-primary mb-1">Reset</a>
                                    </div>
                                    <div class="dropdown">
                                        <a href="javascript:void(0);" class="dropdown-toggle btn bg-white  d-flex align-items-center justify-content-start fs-13 p-2 fw-normal border" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="true">
                                            Select <i class="ti ti-chevron-down ms-auto"></i>
                                        </a>
                                        <div class="dropdown-menu shadow-lg w-100 dropdown-info p-3">
                                            <ul class="mb-3">
                                                <li class="mb-1">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Available
                                                    </label>
                                                </li>
                                                <li class="mb-0">
                                                    <label class="dropdown-item px-2 d-flex align-items-center text-dark">
                                                        <input class="form-check-input m-0 me-2" type="checkbox">
                                                        Unavailable
                                                    </label>
                                                </li>
                                            </ul>
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-outline-white w-100 close-filter">Cancel</a>
                                                </div>
                                                <div class="col-6">
                                                    <a href="javascript:void(0);" class="btn btn-primary w-100">Select</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-footer d-flex align-items-center justify-content-end border-top">
                                <a href="javascript:void(0);" class="btn btn-light btn-md me-2 fw-medium" id="close-filter">Close</a>
                                <button type="submit" class="btn btn-primary btn-md fw-medium">Filter</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="javascript:void(0);" class="dropdown-toggle btn bg-white btn-md d-inline-flex align-items-center fw-normal rounded border text-dark px-2 py-1 fs-14" data-bs-toggle="dropdown">
                        <span  class="me-1"> Sort By : </span>  Recent
                    </a>
                    <ul class="dropdown-menu  dropdown-menu-end p-2">
                        <li>
                            <a href="javascript:void(0);" class="dropdown-item rounded-1">Recent</a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="dropdown-item rounded-1">Oldest</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!--  End Filter -->
        <div class="row">
            <div id="artisanDatatable"></div>
        </div>
    </div>
    <!-- End Content -->

{% endblock %}

{% block javascript %}
    <script src="{{ asset('bundles/datatables/js/datatables.js') }}"></script>
{#    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>#}
{#    <script src="https://cdn.datatables.net/fixedcolumns/5.0.4/js/dataTables.fixedColumns.js"></script>#}
{#    <script src="https://cdn.datatables.net/fixedcolumns/5.0.4/js/fixedColumns.dataTables.js"></script>#}
{#    <script src="https://cdn.datatables.net/select/3.0.1/js/dataTables.select.js"></script>#}
{#
    <script src="https://cdn.datatables.net/select/3.0.1/js/select.dataTables.js"></script>
#}
    <script>
         jQuery(document).ready(function ($) {
           var datatable = null;

           $('#artisanDatatable').initDataTables({{ datatable_settings(datatable) }}, {
                    "bFilter": true,
                    "sDom": 'fBtlpi',
                    "ordering": false,
                    "columnDefs": [
                        {
                            orderable: false,
                            render: DataTable.render.select(),
                            targets: 0
                        }
                    ],
                    "language": {
                        search: ' ',
                        sLengthMenu: '_MENU_',
                        searchPlaceholder: "Rechercher",
                        sLengthMenu: 'Row Per Page _MENU_ Entries',
                        info: "_START_ - _END_ of _TOTAL_ items",
                        paginate: {
                            next: '<i class="ti ti-arrow-right"></i>',
                            previous: '<i class="ti ti-arrow-left"></i> '
                        },
                    },
                    // "select": {
                    //     style: 'os',
                    //     selector: 'td:first-child'
                    // },
                    // "scrollX": true,         // Enable horizontal scrolling
                    // "scrollCollapse": true,  // Adjust table size when the scroll is used
                    "responsive": true,
                    "autoWidth": false,
                    initComplete: (settings, json)=>{
                        $('.dataTables_filter').appendTo('#tableSearch');
                        $('.dataTables_filter').appendTo('.search-input');
                    },
                    ajax: {
                        "url": '{{ path('app_artisan_index') }}',
                        "data": function (d) {
                            d.crm = $("#tagCrmSuggestion").val();
                        }
                    }
            }
            ).then(function(dt) {
               datatable  = dt;
            });

            $(".filter").change(function (e) {
                 $('#artisanDatatable').draw();
            });

            $('.select2').select2();

            const tagCrmSuggestionEl = document.querySelector('#tagCrmSuggestion');

            let tagCrmSuggestion = null;
            $.get('{{ path('app_crm_select2_ajax') }}', function(data){
                let whitelist = data;
                let tagCrmSuggestion = new Tagify(tagCrmSuggestionEl, {
                        whitelist: whitelist,
                        maxTags: 10,
                        dropdown: {
                          maxItems: 20,
                          classname: 'tags-inline',
                          enabled: 0,
                          closeOnSelect: false
                        }
                });
                tagCrmSuggestion.on('add', function(e) {
                    console.log($("#tagCrmSuggestion").val());
                     datatable.draw();
                });
            });

        })
    </script>
{% endblock %}

